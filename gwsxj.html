<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
    古文書寫機
    
    @Project Home   http://code.google.com/p/hanzitool/
    @License        GNU GPL v3
    @Author         Danny Lin <danny.0838(at)gmail.com>
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-tw" />
<title>古文書寫機</title>
<style type="text/css">
#main {border-collapse: collapse;}
#main th {background-color: #eef;}
#main td, #main th { border: 1px dashed #88f; vertical-align: top; padding: 5px;}
fieldset {padding: 0.5em; font-size: 10pt;}
fieldset input, fieldset select {font-size:0.85em;}
textarea {font-size: 0.8em; line-height:1em;}
textarea, #layout td input { font-family: 細明體; }
#layout td {width: 1.5em; height: 1.5em; border: none; padding: 1px; text-align: center; vertical-align: middle;}
#layout td input { width: 1.5em;}
p {margin:0.35em 0 0.35em 0;}
</style>
</head>

<body>

<form id="wrapper" action="javascript:go();">
	<table id="main">
		<tr>
			<th>輸入：</th>
			<td valign="top" style="" width="0" height="0" style="font-size:0.85em" rowspan="4">
			<fieldset>
			<legend>佈局</legend>
			每頁<select size="1" name="D1" onchange="document.getElementById('T1').value=this.value">
			<option value="3">3</option>
			<option value="5">5</option>
			<option value="8">8</option>
			<option value="10">10</option>
			<option selected value="15">15</option>
			<option value="20">20</option>
			<option value="30">30</option>
			<option value="50">50</option>
			<option value="80">80</option>
			<option value="100">100</option>
			</select>行(自訂<input type="text" id="T1" size="2" value="15" onchange="restrictPos(this);" name="T8">)<p>每行<select size="1" name="D2" onchange="document.getElementById('T2').value=this.value">
			<option value="3">3</option>
			<option value="5">5</option>
			<option value="8">8</option>
			<option value="10">10</option>
			<option value="15">15</option>
			<option selected value="20">20</option>
			<option value="30">30</option>
			<option value="50">50</option>
			<option value="80">80</option>
			<option value="100">100</option>
			</select>字(自訂<input type="text" id="T2" size="2" value="20" onchange="restrictPos(this);" name="T9">)</p>
			<p>頁距<input type="text" id="T3" size="2" value="2" onchange="restrictNatural(this);" name="T10">行</p>
			<p>行首縮排<input type="text" id="T5" size="2" value="0" onchange="restrictNatural(this);" name="T11">字</p>
			</fieldset><fieldset>
			<legend>樣式</legend>
			行距<input type="text" id="T4" size="3" value="0" onchange="restrictNatural(this);" name="T12">空白<p>邊框：<select id="line" name="line" onchange="setinputval()" size="1">
                  <option value=",,,,,,,,,,">無</option>
                  <option value=",,,,,,,,,, " selected>清淡半空</option>
                  <option value=",,,,,,,,,,　">清淡全空</option>
                  <option value=",,,,,,,,,,|">半形隔線</option>
                  <option value=",,,,,,,,,,│">全形隔線</option>
                  <option value="┌,┐,└,┘,┬,┴,│,│,─,─,│">單線框</option>
                  <option value="╭,╮,╰,╯,┬,┴,│,│,─,─,│">單線圓角框</option>
                  <option value="╔,╗,╚,╝,╤,╧,║,║,═,═,│">雙線單隔框</option>
                  <option value="╔,╗,╚,╝,╦,╩,║,║,═,═,║">雙線框</option>
                  <option value="╔,╗,╚,╝,╤,╧,║,║,═,═,↓">蝌蚪往回游</option>
                  <option value="╔,╗,╚,╝,╤,╧,║,║,═,═,↑">一切向上看</option>
                  <option value="┼,┼,┼,┼,┬,┴,║,║,─,─,│">清風竹節型</option>
                  <option value="╔,╗,╚,╝,╤,╧,║,║,囍,囍,│">雙喜臨門型</option>
                  <option value="◇,◇,◇,◇,◇,◇,◆,◆,◇,◇,◆">有棱有角型</option>
                  <option value="╔,╗,╚,╝,╤,╧,║,║,═,═,★">紅星閃閃型</option>
                  <option value="●,●,●,●,●,●,║,║,○,○,│">霓虹燈閃爍</option>
                  <option value="▽,▽,△,△,▽,△,│,│,─,─,│">我心依舊型</option>
                  <option value="⊕,⊕,◎,◎,⊕,◎,║,║,○,○,│">大圈套小圈</option>
                  <option value="～,～,～,～,～,～,│,│,～,～,│">魚兒水中游</option>
                  <option value="卐,卐,卐,卐,卐,卐,卐,卐,卐,卐,│">阿彌陀佛型</option>
                </select>
			</p>
			<table id="layout" border="0" cellpadding="0" cellspacing="0">
                  <tbody><tr>
                    <td><input id="a" name="a" type="text"></td>
                    <td><input id="i" name="i" type="text" onchange="setthei(this.value)"></td>
                    <td><input id="e" name="e" type="text"></td>
                    <td><input id="i2" name="i2" type="text" onchange="setthei(this.value)"></td>
                    <td><input id="b" name="b" type="text"></td>
                  </tr>
                  	<tr>
                    <td>
					<input id="g" name="g" type="text" onchange="settheg(this.value)"></td>
                    <td>
					<input name="n1" type="text" disabled="disabled" value="Ｔ"></td>
                    <td>
					<input id="k" name="k" type="text" onchange="setthek(this.value)"></td>
                    <td><input name="n" type="text" disabled="disabled" value="Ｔ"></td>
                    <td><input id="h" name="h" type="text" onchange="settheh(this.value)"></td>
                  </tr>
                  <tr>
                    <td><input id="g2" name="g2" type="text" onchange="settheg(this.value)"></td>
                    <td align="center">
					<input name="n2" type="text" disabled="disabled" value="Ｔ"></td>
                    <td><input id="k2" name="k2" type="text" onchange="setthek(this.value)" value=" "></td>
                    <td align="center">
					<input name="n0" type="text" disabled="disabled" value="Ｔ"></td>
                    <td><input id="h2" name="h2" type="text" onchange="settheh(this.value)"></td>
                  </tr>
                  <tr>
                    <td>
					<input id="g3" name="g3" type="text" onchange="settheg(this.value)"></td>
                    <td align="center">觀</td>
                    <td>
					<input id="k3" name="k3" type="text" onchange="setthek(this.value)" value=" "></td>
                    <td align="center">古</td>
                    <td>
					<input id="h3" name="h3" type="text" onchange="settheh(this.value)"></td>
                  </tr>
                  <tr>
                    <td>
					<input id="g4" name="g4" type="text" onchange="settheg(this.value)"></td>
                    <td align="center">止</td>
                    <td>
					<input id="k4" name="k4" type="text" onchange="setthek(this.value)"></td>
                    <td align="center">文</td>
                    <td>
					<input id="h4" name="h4" type="text" onchange="settheh(this.value)"></td>
                  </tr>
                  <tr>
                    <td>
					<input id="g5" name="g5" type="text" onchange="settheg(this.value)"></td>
                    <td>
					<input name="n5" type="text" disabled="disabled" value="Ｂ"></td>
                    <td>
					<input id="k5" name="k5" type="text" onchange="setthek(this.value)"></td>
                    <td>
					<input name="n3" type="text" disabled="disabled" value="Ｂ"></td>
                    <td>
					<input id="h5" name="h5" type="text" onchange="settheh(this.value)"></td>
                  </tr>
                  <tr>
                    <td>
					<input id="g6" name="g6" type="text" onchange="settheg(this.value)"></td>
                    <td>
					<input name="n6" type="text" disabled="disabled" value="Ｂ"></td>
                    <td>
					<input id="k6" name="k6" type="text" onchange="setthek(this.value)"></td>
                    <td>
					<input name="n4" type="text" disabled="disabled" value="Ｂ"></td>
                    <td>
					<input id="h6" name="h6" type="text" onchange="settheh(this.value)"></td>
                  </tr>
                  <tr>
                    <td><input id="c" name="c" type="text"></td>
                    <td><input id="j" name="j" type="text" onchange="setthej(this.value)"></td>
                    <td><input id="f" name="f" type="text"></td>
                    <td><input id="j2" name="j2" type="text" onchange="setthej(this.value)"></td>
                    <td><input id="d" name="d" type="text"></td>
                  </tr>
              </tbody></table>
			<p>行首修飾 (Ｔ)：<input id="T6" name="T6" type="text" size="6" value=""></p>
			<p>行尾修飾 (Ｂ)：<input id="T7" name="T7" type="text" size="6" value=""></p>
			</fieldset><fieldset>
			<legend>進階設定</legend>
			<p title="刪除不必要的半形空白，英文單字間會保留一個空白。">
			<input type="checkbox" id="C1" name="C1" value="ON">去除空白</p>
			<p title="刪除單獨的換行，二個以上的換行視為換段而保留。">
			<input type="checkbox" id="C2" name="C2" value="ON">去除換行</p>
			<p title="將常見的半形字元（如英文字母、阿拉伯數字、半形標點）轉為全形，使文字能正確對齊。">
			<input type="checkbox" id="C3" checked name="C3" value="ON">全形字元<input type="button" value="自訂" name="B3" onclick="makeFullShapeCustom();"></p>
			<p title="將橫式標點符號轉為直式，如「轉為﹁。">
			<input type="checkbox" id="C4" checked name="C4" value="ON">直式符號<input type="button" value="自訂" name="B4" onclick="makeVerticalCustom();"></p>
			<p title="將刪節號…轉為直式，一般亦使用┆(U+2506)字元，但在某些介面可能無法顯示或對齊。">
			<input type="checkbox" id="C5" name="C5" value="ON" checked>刪節號轉為<input id="T10" name="T15" type="text" size="2" value="︰"></p>
			<p title="去除標點符號。古代常用於排版之【［（保留不刪。">
			<input type="checkbox" id="C10" name="C10" value="ON">去除標點<input type="button" value="自訂" name="B5" onclick="removePuncsCustom();"></p>
			</fieldset><fieldset>
			<legend>古式句讀</legend>
			<p title="仿古文將標點排在文字右方。勾選後文字會變成二行。"><input type="checkbox" id="C6" name="C6" value="ON" onchange="setAncientPunc()">啟用古式旁注句讀</p>
			<p title="將現代標點轉為古代的．。"><input type="checkbox" id="C7" name="C7" value="ON">只用讀號和句號<input type="button" value="自訂" id="B9" name="B9" onclick="punc2onlyCustom();"></p>
			<p title="刪除括號、引號等非旁注符號。"><input type="checkbox" id="C8" name="C8" value="ON">刪除括號引號等<input type="button" value="自訂" id="B7" name="B7" onclick="removeQuotePuncsCustom();"></p>
			<!--<p title="將標點字元縮小，使之在正文右下方。"><input type="checkbox" id="C9" name="C9" value="ON">縮小標點<input type="button" value="自訂" name="B8" onclick="makeSmallPuncCustom();"></p>-->
			</fieldset></td>
		</tr>
		<tr>
			<td>
			<textarea name="INPUT" id="INPUT" rows="20" cols="70"></textarea></td>
		</tr>
		<tr>
			<th>輸出：</th>
		</tr>
		<tr>
			<td>
			<textarea name="OUTPUT" id="OUTPUT" rows="30" cols="70"></textarea></td>
		</tr>
		<tr>
			<td>
			<p align="center"><input type="submit" value="開始轉換" name="B1">　<input type="button" value="轉換(開新視窗)" name="B2" onclick="go(1);"></td>
			<td>
			<p align="right"><span style="font-size:0.8em">古文書寫機 By Danny 2007-2010</span></td>
		</tr>
		</table>
	<p>&nbsp;</p>
</form>

</body>
<script language="javascript">
<!--
String.prototype.times = function(count) {
	return count < 1 ? '' : new Array(count + 1).join(this);
}

String.prototype.escapeHTML = function () {                                       
  return this.replace(/&/g,'&amp;').replace(/>/g,'&gt;').replace(/</g,'&lt;').replace(/"/g,'&quot;').replace(/ (?= )/g,'&nbsp;');
};

String.prototype.escapeRegExp = function() {
  return this.replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
}

// == Initial Settings
if (!window.lang) var lang = {};
lang.patternMB = '請輸入欲處理的字元';
lang.replaceMB = '請輸入處理後的字元，與前項一一對應';
lang.replaceMB1 = '請輸入處理後的字元';

var makeFullShapeP = ' !"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~';
var makeFullShapeR = '　！″＃＄％＆′（）＊＋，－．／０１２３４５６７８９：；＜＝＞？＠ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ〔＼〕︿＿‵ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚ｛｜｝～';

// - － hyphen 連字號 (ASCII) (非標準破折號) -> vertical bar
// | ｜ vertical bar 直線 (ASCII)          -> horizonital bar
// = ＝ equal 等於 (ASCII)                 -> 直 equal
// ‒ figure dash                          -> 不處理
// – en dash                             -> vertical bar
// — em dash 連接號 (破折號)               -> vertical bar
// ― horizonital bar 橫線 (破折號)         -> vertical bar

//;二者互轉
// ─ box drawing light horizontal 製表細橫線 (破折號)
// │ box drawing light vertical 製表細直線

var makeVerticalP = '（）｛｝〔〕【】《》〈〉「」『』﹙﹚﹛﹜﹝﹞‘’“”－–—―｜─│＝';
var makeVerticalR = '︵︶︷︸︹︺︻︼︽︾︿﹀﹁﹂﹃﹄︵︶︷︸︹︺﹁﹂﹃﹄｜｜｜｜－│─‖';

var removePuncsP = '，、。．‧；：？！︰…″｛｝《》〈〉「」『』﹛﹜﹝﹞‘’“”〝〞‵′︷︸︽︾︿﹀﹁﹂﹃﹄';
var punc2only1P = '，、．‧；：';
var punc2only1R = '．';
var punc2only2P = '。？！';
var punc2only2R = '。';
var removeQuotePuncsP = '︰…″（）｛｝《》〈〉「」『』﹙﹚﹛﹜﹝﹞‘’“”〝〞‵′︵︶︷︸︽︾︿﹀﹁﹂﹃﹄';

var makeSmallPuncP = '，、。．‧；：？！';
var makeSmallPuncR = '﹐﹑﹒﹒﹒﹔﹕﹖﹗';

// == Main functions

function str_replace(pattern, replacement, subject) {
	// 據 pattern 調整
	switch (typeof pattern) {
		case 'object':
			if (typeof pattern.length=='undefined') { // RegExp
				var RE = pattern;
				pattern = [pattern];
			}
			else { // Array
				var pattern2 = [], i = pattern.length;
				while(i--) {pattern2[i]=pattern[i].escapeRegExp()};
				var RE = new RegExp(pattern2.join('|'),'g');
			}
			break;
		case 'string':
			var RE = new RegExp(pattern.escapeRegExp(),'g');pattern;
			pattern = [pattern];
			break;
	}
	// 據 replacement 調整
	switch (typeof replacement) {
		case 'string':
			return subject.replace(RE,replacement);
			break;
		case 'object':
			// 若  pattern 較 replacement 多，則多出的部分皆取代為 ''
			var i = pattern.length, I = replacement.length;
			while(--i>=I) {replacement[i]=''}
			return subject.replace(RE,subReplace);
			break;
	}

	return '';
	
	function subReplace(m) {
		for (var i=0,I=pattern.length;i<I;i++) {
			if (m.indexOf(pattern[i])!=-1) {return m.replace(pattern[i],replacement[i]);}
		}
		return m;
	}
}

function go(target) {
	var 頁寬 = parseInt(document.getElementById('T1').value);
	var 頁高 = parseInt(document.getElementById('T2').value);
	var 頁距 = parseInt(document.getElementById('T3').value);
	var 行距 = parseInt(document.getElementById('T4').value);
	var 縮排 = parseInt(document.getElementById('T5').value);

	// 設定行距
	var space = [],i=行距;
	while(i--){space.push(' ');};
	space = space.join('');
	// 設定填空
	var blank = (document.getElementById('C6').checked) ? '　　' : '　';
	
	// 樣式
	var 頁陣 = new Array(), 頁面; // all 0-based

	// 頁首 -> 頁首
	var 頁首=[];
	var t = 設定首中尾修飾('a','e','b');
	var 內容 = document.getElementById('i').value;
	var tmp = 建修飾列(t[0],t[1],內容,t[2]);
	if (tmp) 頁首.push(tmp);

	var t = 設定首中尾修飾('g','k','h');
	var 修飾 = document.getElementById('T6').value;
	if (修飾) {
		修飾 = 修飾字串格式化(修飾);
		for (var i=0,I=修飾.length;i<I;i++){
			頁首.push(建修飾列(t[0],t[1],修飾[i],t[2],true));
		}
	}

	頁首=頁首.join('\n');
	if (頁首) 頁首 = 頁首 + '\n'; else 頁首 = '';

	// 頁尾 -> 頁尾
	var 頁尾=[];
	var t = 設定首中尾修飾('g','k','h');
	var 修飾 = document.getElementById('T7').value;
	if (修飾) {
		修飾 = 修飾字串格式化(修飾);
		for (var i=0,I=修飾.length;i<I;i++){
			頁尾.push(建修飾列(t[0],t[1],修飾[i],t[2],true));
		}
	}

	var t = 設定首中尾修飾('c','f','d');
	var 內容 = document.getElementById('j').value;
	var tmp = 建修飾列(t[0],t[1],內容,t[2]);
	if (tmp) 頁尾.push(tmp);

	頁尾=頁尾.join('\n');
	if (頁尾) 頁尾 = '\n' + 頁尾; else 頁尾 = '';
	
	// 頁間
	var 頁間=[], i=頁距;
	while(i--) 頁間.push('\n');
	頁間 = 頁間.join('');

	// 一般
	var t = 設定首中尾修飾('g','k','h');

	//將內容輸入陣列
	var 輸入 = 字串格式化(document.getElementById('INPUT').value);
	var 行位, 列位;  // all 0-based
	開新頁();
	for (var i=0,I=輸入.length; i<I; i++) {
		插字(i);
	}
	
	// 末頁補空白
	for (var i=列位,I=頁高;i<I;i++){頁面[i][行位] = blank;}
	var i=行位;
	while(i--){
		for (var j=0,J=頁高;j<J;j++){
			頁面[j][i] = blank;
		}
	}

	// 輸出結果
	for (var i=0,I=頁陣.length;i<I;i++) {
		頁面 = 頁陣[i];
		for (var j=0,J=頁高;j<J;j++) {
			頁面[j] = 修飾某列(t[0],t[1],頁面[j],t[2]);
		}
		頁陣[i] = 頁面.join('\n');
	}
	頁陣 = 頁首 + 頁陣.join(頁尾+'\n'+頁間+頁首) + 頁尾;
	輸出結果(頁陣,target);

	function 插字(i) {
		var 字 = 輸入[i]; //讀取字串
		if (字=='\n') {     //換行字元
			// 補上空白
			for (var j=列位,J=頁高;j<J;j++) {
				頁面[j][行位] = blank;
			}
			換行();
		}
		else {
			if (列位>=頁高) {   //字超列，換行
				換行();
			}
			頁面[列位][行位] = 字;
			列位++;
		}
	}

	function 換行() {
		if (行位<=0) {開新頁();}  //末行換行，即超頁，換頁
		else {
			行位--;  //左移一行
			列位 = 0;        //列位歸零，即從上面開始
		}
	}

	function 開新頁() {
		頁面 = new Array();
		for (var i=0,I=頁高;i<I;i++) {頁面[i] = new Array();}
		頁陣.push(頁面);
		行位 = 頁寬-1;
		列位 = 0;
	}
	
	function 輸出結果(output,target) {
		switch (target) {
			case 1:
				var w = window.open();
				var wd = w.document;
				var o = '<body'+'><pre style="line-height:1em;">'+output.escapeHTML()+'</pre></body'+'>';
				wd.write(o);
				wd.close();
				break;
			default:
				document.getElementById('OUTPUT').value = 頁陣;
		}
	}

	function 字串格式化sub(s) {
		//去除空白：去除非單字間之半形空白
		if (document.getElementById('C1').checked) s = s.replace(/ (?!\b)/g,'');
		//去除標點
		if (document.getElementById('C10').checked) s = removePuncs(s);

		//全形化
		if (document.getElementById('C3').checked) s = makeFullShape(s);
		//直式化
		if (document.getElementById('C4').checked) s = makeVertical(s);
		//刪節號
		if (document.getElementById('C5').checked) s = s.replace(/…/g,document.getElementById('T10').value);
		//古式
		if (document.getElementById('C6').checked) {
			//只用讀句號
			if (document.getElementById('C7').checked) s = punc2only(s);
			//刪除其他標點
			if (document.getElementById('C8').checked) s = removeQuotePuncs(s);
			//縮小標點
			//if (document.getElementById('C9').checked) s = makeSmallPunc(s);
			//旁注化
			s = s.split('').join('\r');
			var RE = new RegExp('(.)\r(['+(punc2only1P+punc2only1R+punc2only2P+punc2only2R).escapeRegExp()+'])','g');
			s = s.replace(RE,'$1$2');
			s = s.replace(/(^|\r)(.)(?=\r|$)/g,'$1$2　');
			return s.split('\r');
		}
		return s.split('');
	}

	function 字串格式化(s){ // 傳回陣列
		s = s.replace(/\r\n?/gi,'\n'); //統一換行字元為 \n
		s = s.replace(/\t/gi,'　'); // 定位字元取代為全形空白
		//去除換行
		if (document.getElementById('C2').checked) { 
			s = s.replace(/\n+/g,subReplace);
		}
		//縮排
		縮排 = '　'.times(縮排);
		s = s.replace(/(^\n*|\n\n+)/g,'$1'+縮排);
		return 字串格式化sub(s);

		function subReplace(m){
			if (m.indexOf('\n\n')==-1) return '';  // 1 -> 0
			return (m+'\n').replace(/\n\n/g,'\n'); // 2->2, 3->2, 4->3, 5->3, 6->4, 7->4, ...
		}
	}

	function 修飾字串格式化(s){ // 傳回陣列
		return 字串格式化sub(s);
	}

	function 修飾某列(首修,中空,內容陣列,尾修) {
		return 首修 + 內容陣列.join(中空) + 尾修;
	}	

	function 建修飾列(首修,中空,內容,尾修,nodouble) {
		var 字列=[], i=頁寬;
		if (內容) {
			if (document.getElementById('C6').checked&&!nodouble) {
				while(i--){字列.push(內容+內容);};
			}
			else {
				while(i--){字列.push(內容);};
			}
		}
		return 修飾某列(首修,中空,字列,尾修);
	}
	
	function 設定首中尾修飾(首id,中id,尾id) {
		var 首修 = document.getElementById(首id).value;
		var 中空 = document.getElementById(中id).value;
		var 尾修 = document.getElementById(尾id).value;
		if (首修) 首修 = 首修 + space;
		if (尾修) 尾修 = space + 尾修;
		if (中空) 中空 = space + 中空 + space;
		else 中空 = space;
		return [首修,中空,尾修];
	}
}

// == Helper Funcitons

function pRenew(message,origin) {
	return prompt(message,origin) || origin;
}

function makeFullShape(s) {
	var pattern = makeFullShapeP.split('');
	var replace = makeFullShapeR.split('');
	return str_replace(pattern,replace,s);
}

function makeHalfShapeSpaced(s) {
	var pattern = makeFullShapeP;
	s = s.replace(/(\d)\r(\d)/g,'$1$2');
	s = s.replace(new RegExp('(^|\\r)(['+pattern+'])(?=\\r|$)','g'),'$1 $2');
	return s;
}

function makeFullShapeCustom() {
	makeFullShapeP = pRenew(lang.patternMB,makeFullShapeP);
	makeFullShapeR = pRenew(lang.replaceMB,makeFullShapeR);
}

function makeVertical(s) {
	var pattern = makeVerticalP.split('');
	var replace = makeVerticalR.split('');
	return str_replace(pattern,replace,s);
}

function makeVerticalCustom() {
	makeVerticalP = pRenew(lang.patternMB,makeVerticalP);
	makeVerticalR = pRenew(lang.replaceMB,makeVerticalR);
}

function removePuncs(s) {
	var pattern = removePuncsP.split('');
	var replace = '';
	return str_replace(pattern,replace,s);
}

function removePuncsCustom(s) {
	removePuncsP = pRenew(lang.patternMB,removePuncsP);
}

function punc2only(s) {
	var pattern1 = punc2only1P.split('');
	var replace1 = punc2only1R;
	var pattern2 = punc2only2P.split('');
	var replace2 = punc2only2R;
	s = str_replace(pattern1,replace1,s);
	return str_replace(pattern2,replace2,s);
}

function punc2onlyCustom(s) {
	punc2only1P = pRenew(lang.patternMB,punc2only1P);
	punc2only1R = pRenew(lang.replaceMB1,punc2only1R);
	punc2only2P = pRenew(lang.patternMB,punc2only2P);
	punc2only2R = pRenew(lang.replaceMB1,punc2only2R);
}

function removeQuotePuncs(s) {
	var pattern = removeQuotePuncsP.split('');
	var replace = '';
	return str_replace(pattern,replace,s);
}

function removeQuotePuncsCustom(s) {
	removeQuotePuncsP = pRenew(lang.patternMB,removeQuotePuncsP);
}

function makeSmallPunc(s) {
	var pattern = makeSmallPuncP.split('');
	var replace = makeSmallPuncR.split('');
	return str_replace(pattern,replace,s);
}

function makeSmallPuncCustom(s) {
	makeSmallPuncP = pRenew(lang.patternMB,makeSmallPuncP);
	makeSmallPuncR = pRenew(lang.replaceMB,makeSmallPuncR);
}

// == Operations

// 強制正數
function restrictPos(obj) {
	var v = parseInt(obj.value);
	if (isNaN(v)||v<=0) v = 1;
	obj.value = v;
}

// 強制非零數
function restrictNatural(obj) {
	var v = parseInt(obj.value);
	if (isNaN(v)||v<0) v = 0;
	obj.value = v;
}

function setAncientPunc() {
	var dis = !document.getElementById('C6').checked;
	document.getElementById('C7').disabled = dis;
	document.getElementById('C8').disabled = dis;
	document.getElementById('B9').disabled = dis;
	document.getElementById('B7').disabled = dis;
}

function setinputval() {
	var obj = document.getElementById('line');
	var v = obj.options[obj.selectedIndex].value.split(',');
	document.getElementById("a").value=v[0];
	document.getElementById("b").value=v[1];
	document.getElementById("c").value=v[2];
	document.getElementById("d").value=v[3];
	document.getElementById("e").value=v[4];
	document.getElementById("f").value=v[5];
	settheg(v[6]);
	settheh(v[7]);
	setthei(v[8]);
	setthej(v[9]);
	setthek(v[10]);
}

function settheg(v){
	document.getElementById('g').value = document.getElementById('g2').value = 
	document.getElementById('g3').value = document.getElementById('g4').value = 
	document.getElementById('g5').value = document.getElementById('g6').value = v;
}

function settheh(v){
	document.getElementById('h').value = document.getElementById('h2').value = 
	document.getElementById('h3').value = document.getElementById('h4').value = 
	document.getElementById('h5').value = document.getElementById('h6').value = v;
}

function setthei(v){
	document.getElementById('i').value = document.getElementById('i2').value = v;
}

function setthej(v){
	document.getElementById('j').value = document.getElementById('j2').value = v;
}

function setthek(v){
	document.getElementById('k').value = document.getElementById('k2').value = 
	document.getElementById('k3').value = document.getElementById('k4').value = 
	document.getElementById('k5').value = document.getElementById('k6').value = v;
}

setAncientPunc();
setinputval();
//-->
</script>
</html>